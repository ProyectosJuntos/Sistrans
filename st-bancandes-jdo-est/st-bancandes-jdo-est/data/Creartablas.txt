create sequence Bancandes_sequence;
CREATE TABLE B_OFICINA
   (ID NUMBER, 
	NOMBRE VARCHAR2(255 BYTE) NOT NULL, 
    DIRECCION VARCHAR2(255 BYTE) NOT NULL,
    NUMPATENCION NUMBER NOT NULL,
    TIPOIDGERENTE VARCHAR2(255 BYTE) NOT NULL,
    IDGERENTE NUMBER,
	CONSTRAINT B_OFICINA_PK PRIMARY KEY (ID));

CREATE TABLE B_PUESTOATENCION
   (ID NUMBER, 
   TIPOPUESTO VARCHAR2(255 BYTE) NOT NULL,
	LOCALIZACION VARCHAR2(255 BYTE) NOT NULL, 
    TIPOIDCAJERO VARCHAR2(255 BYTE) NOT NULL,
   IDCAJERO NUMBER NOT NULL,
   IDOFICINA NUMBER,
   CONSTRAINT B_PUESTOATENCION_PK PRIMARY KEY (ID));
   
CREATE TABLE B_ACCION
   (ID NUMBER, 
   COMPANIA VARCHAR2(255 BYTE) NOT NULL,
   VALORACCION NUMBER, 
   IDPRODUCTO NUMBER NOT NULL,
   TIPOIDUSUARIO VARCHAR2(255 BYTE) NOT NULL,
   IDUSUARIO NUMBER,
   CONSTRAINT B_ACCION_PK PRIMARY KEY (ID));
   
CREATE TABLE B_OPERACION
   (ID NUMBER, 
   TIPOOPERACION VARCHAR2(255 BYTE) NOT NULL,
   VALOR NUMBER NOT NULL, 
   FECHA TIMESTAMP NOT NULL,
   IDPUESTOATENCION NUMBER,
   TIPOIDUSUARIO VARCHAR2(255 BYTE) NOT NULL,
   IDUSUARIO NUMBER NOT NULL,
   CUENTA_ORIGEN NUMBER NOT NULL,
CUENTA_DESTINO NUMBER,
TIPOIDEMPLEADO VARCHAR2(255 BYTE),
   IDEMPLEADO NUMBER,
   CONSTRAINT B_OPERACION_PK PRIMARY KEY (ID));
   
CREATE TABLE B_PRODUCTO
   (ID NUMBER, 
	ESTADO VARCHAR2(255 BYTE) NOT NULL,
   VALORACTUAL NUMBER NOT NULL,
   FECHACREACION TIMESTAMP NOT NULL, 
   FECHAULTIMOMOV TIMESTAMP,
   IDOFICINA NUMBER,
   TIPOIDUSUARIO VARCHAR2(255 BYTE) NOT NULL,
   IDUSUARIO NUMBER NOT NULL,
   CONSTRAINT B_PRODUCTO_PK PRIMARY KEY (ID));
   
CREATE TABLE B_CUENTA
   (ID NUMBER, 
   TIPOCUENTA VARCHAR2(255 BYTE) NOT NULL,
   CONSTRAINT B_CUENTA_PK PRIMARY KEY (ID));
   
CREATE TABLE B_CUENTAJURIDICA
(ID NUMBER, 
 VALORAPAGAR NUMBER NOT NULL,
 FRECUENCIA VARCHAR2(255 BYTE) NOT NULL,
 CUENTAPAGAR NUMBER NOT NULL,
CONSTRAINT B_CUENTAJURIDICA_PK PRIMARY KEY (ID));

CREATE TABLE B_CUENTAJURIDICA_CUENTA
(IDCUENTAJURIDICA NUMBER,
IDCUENTA NUMBER,
CONSTRAINT A_CJC_PK PRIMARY KEY (IDCUENTAJURIDICA, IDCUENTA));
     
CREATE TABLE B_AFC
   (ID NUMBER, 
   FECHAPACTADA DATE NOT NULL,
   DINEROINICIAL NUMBER NOT NULL,
   INTERES NUMBER,
   CONSTRAINT B_AFC_PK PRIMARY KEY (ID));
   
CREATE TABLE B_CDT
   (ID NUMBER, 
   FECHAPACTADA DATE NOT NULL,
   CONSTRAINT B_CDT_PK PRIMARY KEY (ID));
   
CREATE TABLE B_PRESTAMO
   (ID NUMBER, 
   CUOTAMINIMA NUMBER NOT NULL,
   CONSTRAINT B_PRESTAMO_PK PRIMARY KEY (ID));
   
CREATE TABLE B_USUARIO
   (TIPOID VARCHAR2(255 BYTE) NOT NULL,
	ID NUMBER, 
   TIPOUSUARIO  VARCHAR2(255 BYTE) NOT NULL,
   LOGIN VARCHAR2(255 BYTE) NOT NULL,
   CLAVE VARCHAR2(255 BYTE) NOT NULL,
   NOMBRE VARCHAR2(255 BYTE) NOT NULL,
   NACIONALIDAD VARCHAR2(255 BYTE) NOT NULL,
   DIRFISICA VARCHAR2(255 BYTE) NOT NULL,
   DIRELECTRONICA VARCHAR2(255 BYTE) NOT NULL,
   TELEFONO VARCHAR2(255 BYTE) NOT NULL,
   CIUDAD VARCHAR2(255 BYTE) NOT NULL,
   DEPARTAMENTO VARCHAR2(255 BYTE) NOT NULL,
   CODIGOPOSTAL NUMBER,
   CONSTRAINT B_USUARIO_PK PRIMARY KEY (TIPOID, ID));
   
   
CREATE TABLE B_EMPLEADO
   (TIPOID VARCHAR2(255 BYTE) NOT NULL,
	ID NUMBER, 
  TIPOEMPLEADO VARCHAR2(255 BYTE) NOT NULL,
  IDPUESTOATENCION  NUMBER,
  IDOFICINA NUMBER,
   CONSTRAINT B_EMPLEADO_PK PRIMARY KEY (TIPOID, ID));

ALTER TABLE B_EMPLEADO
	ADD CONSTRAINT CK_TIPOEMPLEADO_PPTO 
	CHECK (TIPOEMPLEADO IN ('Cajero', 'Gerente oficina','Gerente general', 'Administrador'))
ENABLE;   

ALTER TABLE B_PRODUCTO
 ADD CONSTRAINT CK_valoractual_positivo
CHECK (VALORACTUAL >=0);

ALTER TABLE B_EMPLEADO
ADD CONSTRAINT fk_b_oficina3
    FOREIGN KEY (idoficina)
    REFERENCES b_oficina(id)
ENABLE;

ALTER TABLE B_EMPLEADO
ADD CONSTRAINT fk_b_usuarioh2
    FOREIGN KEY (tipoid,id)
    REFERENCES b_usuario(tipoid,id)
ENABLE;

ALTER TABLE B_EMPLEADO
ADD CONSTRAINT fk_b_puestoatencion1
    FOREIGN KEY (idpuestoatencion)
    REFERENCES b_puestoatencion(id)
ENABLE;

ALTER TABLE B_USUARIO
ADD CONSTRAINT UQ_LOGIN 
UNIQUE (login);

ALTER TABLE B_USUARIO
	ADD CONSTRAINT CK_TIPOUSUARIO_PPTO 
	CHECK (TIPOUSUARIO IN ('Natural', 'Juridica'))
ENABLE;   

ALTER TABLE B_PRESTAMO
ADD CONSTRAINT fk_b_productoh5
    FOREIGN KEY (id)
    REFERENCES b_producto(id)
ENABLE;
   
ALTER TABLE B_CDT
ADD CONSTRAINT fk_b_productoh4
    FOREIGN KEY (id)
    REFERENCES b_producto(id)
ENABLE;
   
ALTER TABLE B_AFC
ADD CONSTRAINT fk_b_productoh3
    FOREIGN KEY (id)
    REFERENCES b_producto(id)
ENABLE;

ALTER TABLE B_CUENTAJURIDICA_CUENTA
ADD CONSTRAINT fk_b_cuentajuridica
    FOREIGN KEY (idcuentajuridica)
    REFERENCES b_cuentajuridica(id)
ENABLE;

ALTER TABLE B_CUENTAJURIDICA_CUENTA
ADD CONSTRAINT fk_b_cuenta12
    FOREIGN KEY (idcuenta)
    REFERENCES b_cuenta(id)
ENABLE;

ALTER TABLE B_CUENTAJURIDICA
	ADD CONSTRAINT ck_frecuencia
	CHECK (FRECUENCIA IN ('Mensual', 'Quincenal'))
ENABLE;   

ALTER TABLE B_CUENTAJURIDICA
ADD CONSTRAINT fk_b_productoh22
    FOREIGN KEY (id)
    REFERENCES b_producto(id)
ENABLE;
   
ALTER TABLE B_CUENTAJURIDICA
ADD CONSTRAINT fk_b_productoh23
    FOREIGN KEY (CUENTAPAGAR)
    REFERENCES b_cuenta(id)
ENABLE;

ALTER TABLE B_CUENTA
	ADD CONSTRAINT CK_TIPOCUENTA_PPTO 
	CHECK (TIPOCUENTA IN ('Ahorros', 'Corriente'))
ENABLE;   

ALTER TABLE B_CUENTA
ADD CONSTRAINT fk_b_productoh2
    FOREIGN KEY (id)
    REFERENCES b_producto(id)
ENABLE;

ALTER TABLE B_PRODUCTO
	ADD CONSTRAINT CK_ESTADO_PPTO 
	CHECK (ESTADO IN ('Activa', 'Cerrada', 'Desactivada'))
ENABLE; 
  
ALTER TABLE B_PRODUCTO
ADD CONSTRAINT fk_b_oficina2
    FOREIGN KEY (idoficina)
    REFERENCES b_oficina(id)
ENABLE;

ALTER TABLE B_PRODUCTO
ADD CONSTRAINT fk_b_usuario4
    FOREIGN KEY (tipoidusuario,idusuario)
    REFERENCES b_usuario(tipoid,id)
ENABLE;
   
ALTER TABLE B_OPERACION
	ADD CONSTRAINT CK_TIPOOPERCION
	CHECK (TIPOOPERACION IN ('Retiro', 'Consignacion', 'Transferencia'))
ENABLE; 
   
   ALTER TABLE B_OPERACION
ADD CONSTRAINT fk_b_puestoatencion
    FOREIGN KEY (idpuestoatencion)
    REFERENCES b_puestoatencion(id)
ENABLE;

ALTER TABLE B_OPERACION
ADD CONSTRAINT fk_b_empleado2
    FOREIGN KEY (tipoidempleado,idempleado)
    REFERENCES b_empleado(tipoid,id)
ENABLE;

ALTER TABLE B_OPERACION
ADD CONSTRAINT fk_b_usuario2
    FOREIGN KEY (tipoidusuario,idusuario)
    REFERENCES b_usuario(tipoid,id)
ENABLE;

ALTER TABLE B_OPERACION
ADD CONSTRAINT fk_a_producto2
    FOREIGN KEY (cuenta_origen)
    REFERENCES b_producto(id)
ENABLE;

ALTER TABLE B_OPERACION
ADD CONSTRAINT fk_a_producto22
    FOREIGN KEY (cuenta_destino)
    REFERENCES b_producto(id)
ENABLE;

ALTER TABLE B_ACCION
ADD CONSTRAINT fk_b_producto
    FOREIGN KEY (idproducto)
    REFERENCES b_producto(id)
ENABLE;

ALTER TABLE B_ACCION
ADD CONSTRAINT fk_b_usuario
    FOREIGN KEY (tipoidusuario,idusuario)
    REFERENCES b_usuario(tipoid,id)
ENABLE;
   
ALTER TABLE B_PUESTOATENCION
ADD CONSTRAINT fk_b_empleado1
    FOREIGN KEY (tipoidcajero,idcajero)
    REFERENCES b_empleado(tipoid,id)
ENABLE;

ALTER TABLE B_PUESTOATENCION
ADD CONSTRAINT fk_b_oficina
    FOREIGN KEY (idoficina)
    REFERENCES b_oficina(id)
ENABLE;

ALTER TABLE B_PUESTOATENCION
	ADD CONSTRAINT CK_PUESTOATENCION_PPTO 
	CHECK (TIPOPUESTO IN ('Oficina', 'ATM', 'Web', 'Movil'))
ENABLE;   

ALTER TABLE B_OFICINA
ADD CONSTRAINT fk_b_empleado
    FOREIGN KEY (tipoidgerente,idgerente)
    REFERENCES b_empleado(tipoid,id)
ENABLE;